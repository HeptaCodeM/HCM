<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hcm.grw.model.mapper.hr.EmployeeListDaoImpl">
	
	
	<select id="selectAllEmployee" resultType="EmployeeDto">
	SELECT 		
				A.EMPL_ID,
	            A.EMPL_NAME,
	            A.EMPL_PHONE, 
	            C1.COCO_CD AS COCO_CD_DCD,
	            C1.COCO_NAME AS COCO_NAME_DNM,
	            C2.COCO_CD AS COCO_CD_RCD,
	            C2.COCO_NAME AS COCO_NAME_RNM,
	            C3.COCO_CD AS COCO_CD_PCD,
	            C3.COCO_NAME AS COCO_NAME_PNM,
	            A.EMPL_JOINDATE,
	            A.EMPL_LEAVEDATE  
	FROM          EMPLOYEE A
	INNER JOIN      COMMON_CODE C1 ON A.EMPL_DEPT_CD = C1.COCO_CD
	INNER JOIN      COMMON_CODE C2 ON A.EMPL_RANK_CD = C2.COCO_CD
	LEFT OUTER JOIN   COMMON_CODE C3 ON A.EMPL_POSITION_CD  = C3.COCO_CD
	ORDER BY A.EMPL_ID DESC
	</select>
	
	<select id="searchAllEmployee" parameterType="Map" resultType="EmployeeDto">
	SELECT 
				A.EMPL_ID,
	            A.EMPL_NAME, 
	            A.EMPL_PHONE,
	            C1.COCO_CD AS COCO_CD_DCD,
	            C1.COCO_NAME AS COCO_NAME_DNM,
	            C2.COCO_CD AS COCO_CD_RCD,
	            C2.COCO_NAME AS COCO_NAME_RNM,
	            C3.COCO_CD AS COCO_CD_PCD,
	            C3.COCO_NAME AS COCO_NAME_PNM,
	            A.EMPL_JOINDATE,
	            A.EMPL_LEAVEDATE  
	FROM          EMPLOYEE A
	INNER JOIN      COMMON_CODE C1 ON A.EMPL_DEPT_CD = C1.COCO_CD
	INNER JOIN      COMMON_CODE C2 ON A.EMPL_RANK_CD = C2.COCO_CD
	LEFT OUTER JOIN   COMMON_CODE C3 ON A.EMPL_POSITION_CD  = C3.COCO_CD
	<choose>
		<when test="searchCtg == 'empl_name'">
			WHERE A.EMPL_NAME = #{empl_name}
		</when>
		<when test="searchCtg == 'empl_id'">
			WHERE A.EMPL_ID = #{empl_id}
		</when>
		<when test="searchCtg == 'empl_phone'">
			WHERE A.EMPL_PHONE = #{empl_phone}
		</when>
		<otherwise>
			WHERE A.EMPL_NAME = #{empl_name}
		</otherwise>
	</choose>
	
	<choose>
		<when test="empl_delflag == 'N'">
			AND A.EMPL_DELFLAG = 'N'
		</when>
		<when test="empl_delflag == 'Y'">
			AND A.EMPL_DELFLAG = 'Y'
		</when>
	</choose>
	
	<if test="startdate != null and enddate != null">
		AND TO_DATE(A.EMPL_JOINDATE) BETWEEN TO_DATE(#{startdate},'YYYY-MM-DD') AND TO_DATE(#{enddate},'YYYY-MM-DD')
	</if>
	
	
	<if test="empl_dept_cd != null">
		AND A.EMPL_DEPT_CD = 
		<foreach collection="dtArr" item="dtA" open="(" separator="," close=")">
			#{dtA}
		</foreach>
	</if>
<!-- 	<if test="empl_rank_cd != null">
		AND A.EMPL_RANK_CD = #{empl_rank_cd}
	</if>
	<if test="empl_position_cd != null">
		AND A.EMPL_POSITION_CD = #{empl_position_cd}
	</if> -->
	</select>
	
	<select id="selectOneEmployee" parameterType="Map" resultType="EmployeeDto">
		SELECT 
					A.EMPL_ID,
		            A.EMPL_NAME,
		            A.EMPL_BIRTH,
		            A.EMPL_EMAIL,
		            A.EMPL_PHONE,
		            A.EMPL_TEL,
		            A.EMPL_FAX,
		            C1.COCO_CD AS COCO_CD_DCD,
		            C1.COCO_NAME AS COCO_NAME_DNM,
		            C2.COCO_CD AS COCO_CD_RCD,
		            C2.COCO_NAME AS COCO_NAME_RNM,
		            C3.COCO_CD AS COCO_CD_PCD,
		            C3.COCO_NAME AS COCO_NAME_PNM,
		            A.EMPL_JOINDATE,
		            A.EMPL_LEAVEDATE,
		            A.EMPL_PICTURE
		FROM          EMPLOYEE A
		INNER JOIN      COMMON_CODE C1 ON A.EMPL_DEPT_CD = C1.COCO_CD
		INNER JOIN      COMMON_CODE C2 ON A.EMPL_RANK_CD = C2.COCO_CD
		LEFT OUTER JOIN   COMMON_CODE C3 ON A.EMPL_POSITION_CD  = C3.COCO_CD
			WHERE A.EMPL_ID = #{empl_id}
	</select>
	
	<update id="correctionEmployee" parameterType="Map">
		UPDATE EMPLOYEE SET EMPL_NAME = #{empl_name},
					EMPL_BIRTH = #{empl_birth},
					EMPL_EMAIL = #{empl_email},
					EMPL_PHONE = #{empl_phone},
					EMPL_TEL = #{empl_tel},
					EMPL_FAX = #{empl_fax},
					EMPL_MODIFY_ID = #{empl_modify_id},
					EMPL_MODIFY_DT = CURRENT_DATE
		WHERE EMPL_ID = #{empl_id}
	</update>
	
</mapper>
